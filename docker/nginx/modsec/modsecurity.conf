## Minimal ModSecurity configuration (stub)
# You will need a ModSecurity-enabled Nginx build to use these settings.
# Set SecRuleEngine to On/DetectionOnly/Off to control blocking behavior.



## Hardened ModSecurity configuration
## NOTE: This file is intended for production-like blocking. Test in a staging
## environment before enabling in production. Tuned settings follow best-practice
## defaults: body access enabled, reasonable limits, robust audit logging, and
## blocking enabled.

# Enable blocking (change to DetectionOnly for initial testing)
SecRuleEngine On

# Request/response body handling
SecRequestBodyAccess On
SecResponseBodyAccess Off
# Limits to guard memory usage (tune to your environment)
SecRequestBodyLimit 13107200
SecRequestBodyNoFilesLimit 131072
SecRequestBodyInMemoryLimit 131072

# Disable script engine for safety
SecRuleScriptEngine Off

# Audit log â€” capture relevant events and failures
SecAuditEngine RelevantOnly
SecAuditLog /var/log/modsec_audit.log
SecAuditLogParts ABIJDEFHZ

# Default action to block when rules match in phase 2
SecDefaultAction "phase:2,log,auditlog,deny,status:403"

# Performance: don't inspect very large request headers
SecRequestBodyLimitAction Reject

# Recommended recommended hygiene
SecPcreMatchLimit 2000
SecPcreMatchLimitRecursion 2000

# Load recommended CRS setup if present (CRS installed under /etc/nginx/modsec/crs)
Include /etc/nginx/modsec/crs/crs-3.3.0/crs-setup.conf
Include /etc/nginx/modsec/crs/crs-3.3.0/rules/*.conf
