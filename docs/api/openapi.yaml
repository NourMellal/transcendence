openapi: 3.0.3
info:
  title: Transcendence API
  description: |
    Real-time multiplayer Pong game with microservices architecture.
    
    Features:
    - üîê OAuth & 2FA Authentication
    - üéÆ Real-time Pong gameplay
    - üí¨ Live chat & messaging
    - üèÜ Tournament system
    - üìä Statistics & leaderboards
    
    Architecture: Event-driven microservices with RabbitMQ messaging.
  version: 1.0.0
  license:
    name: ISC
    url: https://opensource.org/licenses/ISC
  contact:
    name: Transcendence Team
    url: https://github.com/NourMellal/transcendence
servers:
  - url: http://localhost:3000/api
    description: Local development server (API Gateway)
  # - url: https://api.transcendence.dev
  #   description: Development environment

components:
  securitySchemes:
    jwtAuth:
      $ref: './components/security.yaml#/securitySchemes/jwtAuth'
  
  schemas:
    # Auth schemas
    User:
      $ref: './components/schemas/user.yaml#/User'
    SignUpRequest:
      $ref: './components/schemas/auth.yaml#/SignUpRequest'
    LoginRequest:
      $ref: './components/schemas/auth.yaml#/LoginRequest'
    LoginResponse:
      $ref: './components/schemas/auth.yaml#/LoginResponse'
    TwoFactorSecret:
      $ref: './components/schemas/auth.yaml#/TwoFactorSecret'
    Enable2FARequest:
      $ref: './components/schemas/auth.yaml#/Enable2FARequest'
    UpdateUserRequest:
      $ref: './components/schemas/user.yaml#/UpdateUserRequest'
    DeleteUserRequest:
      $ref: './components/schemas/user.yaml#/DeleteUserRequest'
    DeleteUserResponse:
      $ref: './components/schemas/user.yaml#/DeleteUserResponse'
    
    # Game schemas
    Game:
      $ref: './components/schemas/game.yaml#/Game'
    CreateGameRequest:
      $ref: './components/schemas/game.yaml#/CreateGameRequest'
    JoinGameRequest:
      $ref: './components/schemas/game.yaml#/JoinGameRequest'
    GameMove:
      $ref: './components/schemas/game.yaml#/GameMove'
    
    # Chat schemas
    ChatMessage:
      $ref: './components/schemas/chat.yaml#/ChatMessage'
    SendMessageRequest:
      $ref: './components/schemas/chat.yaml#/SendMessageRequest'
    Conversation:
      $ref: './components/schemas/chat.yaml#/Conversation'
    ChatInviteAcceptResponse:
      $ref: './components/schemas/chat.yaml#/ChatInviteAcceptResponse'
    ChatInviteDeclineResponse:
      $ref: './components/schemas/chat.yaml#/ChatInviteDeclineResponse'
    ChatInviteErrorResponse:
      $ref: './components/schemas/chat.yaml#/ChatInviteErrorResponse'
    
    # Tournament schemas
    TournamentSummary:
      $ref: './components/schemas/tournament.yaml#/TournamentSummary'
    TournamentDetail:
      $ref: './components/schemas/tournament.yaml#/TournamentDetail'
    TournamentMatch:
      $ref: './components/schemas/tournament.yaml#/TournamentMatch'
    CreateTournamentRequest:
      $ref: './components/schemas/tournament.yaml#/CreateTournamentRequest'
    CreateTournamentResponse:
      $ref: './components/schemas/tournament.yaml#/CreateTournamentResponse'
    JoinTournamentResponse:
      $ref: './components/schemas/tournament.yaml#/JoinTournamentResponse'
    PlayMatchResponse:
      $ref: './components/schemas/tournament.yaml#/PlayMatchResponse'
    
    # Stats schemas
    UserStats:
      $ref: './components/schemas/stats.yaml#/UserStats'
    Leaderboard:
      $ref: './components/schemas/stats.yaml#/Leaderboard'

    # Friend schemas
    Friendship:
      $ref: './components/schemas/friend.yaml#/Friendship'
    Friend:
      $ref: './components/schemas/friend.yaml#/Friend'
    FriendListResponse:
      $ref: './components/schemas/friend.yaml#/FriendListResponse'
    SendFriendRequest:
      $ref: './components/schemas/friend.yaml#/SendFriendRequest'
    RespondFriendRequest:
      $ref: './components/schemas/friend.yaml#/RespondFriendRequest'
    
    # Common schemas
    Error:
      $ref: './components/schemas/common.yaml#/Error'

security:
  - jwtAuth: []

paths:
  # Authentication endpoints
  /auth/signup:
    $ref: './paths/auth.yaml#/~1auth~1signup'
  /auth/login:
    $ref: './paths/auth.yaml#/~1auth~1login'
  /auth/refresh:
    $ref: './paths/auth.yaml#/~1auth~1refresh'
  /auth/42/login:
    $ref: './paths/auth.yaml#/~1auth~142~1login'
  /auth/42/callback:
    $ref: './paths/auth.yaml#/~1auth~142~1callback'
  /auth/status:
    $ref: './paths/auth.yaml#/~1auth~1status'
  /auth/logout:
    $ref: './paths/auth.yaml#/~1auth~1logout'
  /auth/2fa/generate:
    $ref: './paths/auth.yaml#/~1auth~12fa~1generate'
  /auth/2fa/enable:
    $ref: './paths/auth.yaml#/~1auth~12fa~1enable'
  /auth/2fa/disable:
    $ref: './paths/auth.yaml#/~1auth~12fa~1disable'
  
  # User endpoints
  /users/me:
    $ref: './paths/users.yaml#/~1users~1me'
  /users/{userId}:
    $ref: './paths/users.yaml#/~1users~1{userId}'
  /users/by-username/{username}:
    $ref: './paths/users.yaml#/~1users~1by-username~1{username}'
  /friends:
    $ref: './paths/friends.yaml#/~1friends'
  /friends/requests:
    $ref: './paths/friends.yaml#/~1friends~1requests'
  /friends/requests/{friendshipId}:
    $ref: './paths/friends.yaml#/~1friends~1requests~1{friendshipId}'
  /friends/{userId}/block:
    $ref: './paths/friends.yaml#/~1friends~1{userId}~1block'
  /friends/{userId}:
    $ref: './paths/friends.yaml#/~1friends~1{userId}'
  
  # Game endpoints
  /games:
    $ref: './paths/games.yaml#/~1games'
  /games/{gameId}:
    $ref: './paths/games.yaml#/~1games~1{gameId}'
  /games/{gameId}/join:
    $ref: './paths/games.yaml#/~1games~1{gameId}~1join'
  /games/{gameId}/ready:
    $ref: './paths/games.yaml#/~1games~1{gameId}~1ready'
  /games/{gameId}/leave:
    $ref: './paths/games.yaml#/~1games~1{gameId}~1leave'
  /games/my-games:
    $ref: './paths/games.yaml#/~1games~1my-games'
  /games/ws/socket.io:
    $ref: './paths/games.yaml#/~1games~1ws~1socket.io'
  
  # Chat endpoints
  /chat/messages:
    $ref: './paths/chat.yaml#/~1chat~1messages'
  /chat/conversations:
    $ref: './paths/chat.yaml#/~1chat~1conversations'
  /chat/invites/{inviteId}/accept:
    $ref: './paths/chat.yaml#/~1chat~1invites~1{inviteId}~1accept'
  /chat/invites/{inviteId}/decline:
    $ref: './paths/chat.yaml#/~1chat~1invites~1{inviteId}~1decline'
  /chat/ws:
    $ref: './paths/chat.yaml#/~1chat~1ws'
  
  # Tournament endpoints
  /tournaments:
    $ref: './paths/tournaments.yaml#/~1tournaments'
  /tournaments/{tournamentId}:
    $ref: './paths/tournaments.yaml#/~1tournaments~1{tournamentId}'
  /tournaments/{tournamentId}/join:
    $ref: './paths/tournaments.yaml#/~1tournaments~1{tournamentId}~1join'
  /tournaments/{tournamentId}/start:
    $ref: './paths/tournaments.yaml#/~1tournaments~1{tournamentId}~1start'
  /tournaments/{tournamentId}/leave:
    $ref: './paths/tournaments.yaml#/~1tournaments~1{tournamentId}~1leave'
  /tournaments/{tournamentId}/bracket:
    $ref: './paths/tournaments.yaml#/~1tournaments~1{tournamentId}~1bracket'
  /tournaments/{tournamentId}/matches/{matchId}/play:
    $ref: './paths/tournaments.yaml#/~1tournaments~1{tournamentId}~1matches~1{matchId}~1play'
  /tournaments/my-tournaments:
    $ref: './paths/tournaments.yaml#/~1tournaments~1my-tournaments'
  
  # Stats endpoints
  /stats/me:
    $ref: './paths/stats.yaml#/~1stats~1me'
  /stats/users/{userId}:
    $ref: './paths/stats.yaml#/~1stats~1users~1{userId}'
  /leaderboard:
    $ref: './paths/stats.yaml#/~1leaderboard'
  
  # Health endpoint
  /health:
    $ref: './paths/health.yaml#/~1health'
