input {
  beats {
    # Use fixed Beats port (compose maps host/containers to 5044)
    port => 5044
  }
}

filter {
  mutate {
    add_field => { "stack" => "transcendence" }
  }

  # Normalize fields so schema stays stable even if first log is different
  if [level] {
    mutate { convert => { "level" => "string" } }
  }

  # Accept either ISO8601 strings or epoch millis in "time"
  if [time] {
    date {
      match => ["time", "ISO8601", "UNIX_MS"]
      target => "@timestamp"
      remove_field => ["time"]
    }
  }
}

output {
  elasticsearch {
    hosts => ["${ELASTICSEARCH_HOST}"]
    index => "${ELASTICSEARCH_INDEX_PREFIX}-%{+YYYY.MM.dd}"
  }
  stdout { codec => rubydebug }
}
